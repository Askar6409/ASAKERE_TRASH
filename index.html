<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>  تراشکاری عساکره </title>
    <style>
        :root {
            --bg-primary: #0f0f0f;
            --bg-secondary: #1c1c1c;
            --bg-tertiary: #222;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --accent-primary: #2ecc71;
            --accent-hover: #27ae60;
            --border-radius: 12px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --font-family: 'Vazirmatn', 'Segoe UI', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: var(--font-family);
            line-height: 1.6;
            padding: var(--spacing-md);
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h2 {
            text-align: center;
            margin-bottom: var(--spacing-lg);
            color: var(--accent-primary);
            font-size: 1.8rem;
            width: 100%;
        }

        .container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
            width: 100%;
        }

        .card {
            background: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s ease;
            text-align: center;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .card-title {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
            color: var(--accent-primary);
            font-size: 1.1rem;
        }

        .card-title i {
            font-size: 1.2rem;
        }

        .form-group {
            margin-bottom: var(--spacing-md);
            text-align: center;
        }

        .form-label {
            display: block;
            margin-bottom: var(--spacing-sm);
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .form-input {
            width: 100%;
            padding: 10px var(--spacing-md);
            background: var(--bg-tertiary);
            border: 1px solid #333;
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
            text-align: center;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 2px rgba(46, 204, 113, 0.2);
        }

        .form-input::placeholder {
            color: #666;
        }

        .btn {
            width: 100%;
            padding: 12px var(--spacing-md);
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }

        .btn:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-icon {
            font-size: 1.2rem;
        }

        .product-grid {
            display: grid;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-md);
        }

        .product-item {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr auto;
            gap: var(--spacing-sm);
            align-items: center;
            background: var(--bg-tertiary);
            padding: var(--spacing-md);
            border-radius: 8px;
            border: 1px solid #333;
            text-align: center;
        }

        .product-info {
            text-align: center;
        }

        .product-info h4 {
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .product-info small {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .product-input {
            width: 100%;
            padding: 8px;
            background: var(--bg-secondary);
            border: 1px solid #444;
            border-radius: 6px;
            color: var(--text-primary);
            text-align: center;
        }

        .product-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            margin: 0 auto;
        }

        .total-section {
            background: linear-gradient(135deg, var(--accent-primary), #27ae60);
            color: white;
            padding: var(--spacing-lg);
            border-radius: var(--border-radius);
            text-align: center;
            margin: var(--spacing-lg) 0;
            font-size: 1.2rem;
            font-weight: bold;
            box-shadow: 0 6px 20px rgba(46, 204, 113, 0.3);
            width: 100%;
        }

        .history-section {
            max-height: 400px;
            overflow-y: auto;
            padding-right: var(--spacing-sm);
            width: 100%;
        }

        .history-section::-webkit-scrollbar {
            width: 8px;
        }

        .history-section::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 4px;
        }

        .history-section::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 4px;
        }

        .invoice-item {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            border-right: 4px solid var(--accent-primary);
            text-align: center;
        }

        .invoice-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: var(--spacing-sm);
            padding-bottom: var(--spacing-sm);
            border-bottom: 1px solid #333;
        }

        .invoice-items {
            margin: var(--spacing-sm) 0;
        }

        .invoice-item-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            color: var(--text-secondary);
            font-size: 0.9rem;
            border-bottom: 1px dashed #333;
        }

        .invoice-total {
            text-align: center;
            font-weight: bold;
            color: var(--accent-primary);
            margin-top: var(--spacing-md);
            padding-top: var(--spacing-sm);
            border-top: 2px solid var(--accent-primary);
        }

        .alert {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: var(--spacing-md);
            background: var(--accent-primary);
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transform: translateX(150%);
            transition: transform 0.3s ease;
            z-index: 1000;
            text-align: center;
        }

        .alert.show {
            transform: translateX(0);
        }

        .alert.error {
            background: #e74c3c;
        }

        /* Centering all elements */
        .center-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .product-item {
                grid-template-columns: 1fr;
                gap: var(--spacing-md);
                text-align: center;
            }
            
            .product-input {
                text-align: center;
            }
            
            .invoice-item-row {
                flex-direction: column;
                gap: 4px;
                text-align: center;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css">
</head>
<body>
    <div class="center-container">
        <h2><i class='bx bx-store'></i> سیستم فروش حرفه‌ای</h2>

        <div class="container">
            <div class="card">
                <div class="card-title">
                    <i class='bx bx-user'></i>
                    اطلاعات مشتری
                </div>
                <div class="form-group">
                    <input type="text" id="customerName" class="form-input" placeholder="نام مشتری">
                </div>
                <div class="form-group">
                    <input type="tel" id="customerPhone" class="form-input" placeholder="شماره تماس">
                </div>
            </div>

            <div class="card">
                <div class="card-title">
                    <i class='bx bx-plus-circle'></i>
                    افزودن محصول جدید
                </div>
                <div class="form-group">
                    <input type="text" id="newName" class="form-input" placeholder="نام محصول">
                </div>
                <div class="form-group">
                    <input type="number" id="newPrice" class="form-input" placeholder="قیمت (ریال)">
                </div>
                <div class="form-group">
                    <input type="number" id="newStock" class="form-input" placeholder="موجودی اولیه">
                </div>
                <button class="btn" onclick="addProduct()">
                    <i class='bx bx-plus btn-icon'></i>
                    افزودن محصول
                </button>
            </div>
        </div>

        <div class="card" style="width: 100%;">
            <div class="card-title">
                <i class='bx bx-package'></i>
                لیست محصولات
            </div>
            <div id="products" class="product-grid"></div>
        </div>

        <div id="total" class="total-section">
            <i class='bx bx-calculator'></i>
            جمع کل: 0 ریال
        </div>

        <button class="btn" onclick="generateInvoice()" style="width: 100%; margin-bottom: var(--spacing-lg);">
            <i class='bx bx-receipt btn-icon'></i>
            صدور فاکتور
        </button>

        <div class="card" style="width: 100%;">
            <div class="card-title">
                <i class='bx bx-history'></i>
                تاریخچه فروش
            </div>
            <div id="history" class="history-section"></div>
        </div>
    </div>

    <div id="alert" class="alert"></div>

    <script>
        class SalesSystem {
            constructor() {
                this.products = JSON.parse(localStorage.getItem("products")) || [
                    { id: 1, name: "پیچ", price: 10000, stock: 50 }, // 1000 تومان = 10000 ریال
                    { id: 2, name: "مهره", price: 8000, stock: 80 }, // 800 تومان = 8000 ریال
                    { id: 3, name: "بلبرینگ", price: 120000, stock: 15 } // 12000 تومان = 120000 ریال
                ];
                this.invoices = JSON.parse(localStorage.getItem("invoices")) || [];
                this.invoiceNumber = Number(localStorage.getItem("invoiceNumber")) || 1;
                this.container = document.getElementById("products");
                this.init();
            }

            init() {
                this.renderProducts();
                this.renderHistory();
                this.setupEventListeners();
            }

            setupEventListeners() {
                document.addEventListener('input', (e) => {
                    if (e.target.id.startsWith('qty-') || e.target.id.startsWith('price-')) {
                        this.calculateTotal();
                    }
                });

                document.addEventListener('change', (e) => {
                    if (e.target.type === 'checkbox') {
                        this.calculateTotal();
                    }
                });
            }

            save() {
                localStorage.setItem("products", JSON.stringify(this.products));
                localStorage.setItem("invoices", JSON.stringify(this.invoices));
                localStorage.setItem("invoiceNumber", this.invoiceNumber);
            }

            showAlert(message, type = 'success') {
                const alert = document.getElementById('alert');
                alert.textContent = message;
                alert.className = `alert ${type}`;
                alert.classList.add('show');
                
                setTimeout(() => {
                    alert.classList.remove('show');
                }, 3000);
            }

            renderProducts() {
                this.container.innerHTML = '';
                
                this.products.forEach((product, index) => {
                    const productElement = document.createElement('div');
                    productElement.className = 'product-item';
                    
                    productElement.innerHTML = `
                        <div class="product-info">
                            <h4>${product.name}</h4>
                            ${product.stock !== undefined ? `<small>موجودی: ${product.stock.toLocaleString()} عدد</small>` : ''}
                        </div>
                        <input type="number" 
                               id="price-${index}" 
                               class="product-input" 
                               value="${product.price}" 
                               min="0"
                               placeholder="قیمت (ریال)">
                        <input type="number" 
                               id="qty-${index}" 
                               class="product-input" 
                               value="0" 
                               min="0" 
                               ${product.stock !== undefined ? `max="${product.stock}"` : ''}
                               placeholder="تعداد">
                        <input type="checkbox" 
                               class="product-checkbox" 
                               ${product.stock === 0 || product.stock === undefined ? 'disabled' : ''}>
                    `;
                    
                    this.container.appendChild(productElement);
                });
                
                this.calculateTotal();
            }

            addProduct() {
                const name = document.getElementById("newName").value.trim();
                const price = Number(document.getElementById("newPrice").value);
                const stock = Number(document.getElementById("newStock").value);

                if (!name) {
                    this.showAlert("نام محصول الزامی است!", "error");
                    return;
                }

                if (price <= 0) {
                    this.showAlert("قیمت باید بیشتر از صفر باشد!", "error");
                    return;
                }

                if (stock < 0 || isNaN(stock)) {
                    this.showAlert("موجودی معتبر وارد کنید!", "error");
                    return;
                }

                const newProduct = {
                    id: Date.now(),
                    name,
                    price: price, // ذخیره به ریال
                    stock: stock
                };

                this.products.push(newProduct);
                this.save();
                this.renderProducts();

                document.getElementById("newName").value = "";
                document.getElementById("newPrice").value = "";
                document.getElementById("newStock").value = "";

                this.showAlert("محصول با موفقیت اضافه شد!");
            }

            calculateTotal() {
                let total = 0;

                this.products.forEach((product, index) => {
                    const qtyInput = document.getElementById(`qty-${index}`);
                    const priceInput = document.getElementById(`price-${index}`);
                    const checkbox = document.querySelectorAll('.product-checkbox')[index];
                    
                    if (qtyInput && priceInput && checkbox) {
                        const qty = Number(qtyInput.value) || 0;
                        const price = Number(priceInput.value) || 0;
                        
                        // به‌روزرسانی قیمت محصول
                        if (product.price !== price) {
                            product.price = price;
                            this.save();
                        }
                        
                        if (checkbox.checked) {
                            total += qty * price;
                        }
                    }
                });

                const totalElement = document.getElementById("total");
                totalElement.innerHTML = `
                    <i class='bx bx-calculator'></i>
                    جمع کل: ${total.toLocaleString()} ریال
                `;
            }

            generateInvoice() {
                const name = document.getElementById("customerName").value.trim();
                const phone = document.getElementById("customerPhone").value.trim();
                const items = [];
                let total = 0;
                let hasError = false;

                this.products.forEach((product, index) => {
                    const qtyInput = document.getElementById(`qty-${index}`);
                    const checkbox = document.querySelectorAll('.product-checkbox')[index];
                    
                    if (!qtyInput || !checkbox) return;
                    
                    const qty = Number(qtyInput.value) || 0;

                    if (checkbox.checked && qty > 0) {
                        if (product.stock !== undefined && qty > product.stock) {
                            this.showAlert(`موجودی ${product.name} کافی نیست!`, "error");
                            hasError = true;
                            return;
                        }

                        const subtotal = qty * product.price;
                        total += subtotal;

                        items.push({
                            name: product.name,
                            quantity: qty,
                            price: product.price,
                            subtotal
                        });

                        // به‌روزرسانی موجودی
                        if (product.stock !== undefined) {
                            product.stock -= qty;
                        }
                    }
                });

                if (hasError) return;

                if (items.length === 0) {
                    this.showAlert("لطفا حداقل یک محصول انتخاب کنید!", "error");
                    return;
                }

                const invoice = {
                    number: this.invoiceNumber++,
                    customer: name || "مشتری ناشناس",
                    phone: phone || "ثبت نشده",
                    date: new Date().toLocaleString('fa-IR'),
                    items,
                    total
                };

                this.invoices.unshift(invoice);
                this.save();
                this.renderHistory();
                this.renderProducts();

                document.getElementById("customerName").value = "";
                document.getElementById("customerPhone").value = "";

                this.showAlert(`فاکتور شماره ${invoice.number} با موفقیت صادر شد!`);
            }

            renderHistory() {
                const historyContainer = document.getElementById("history");
                historyContainer.innerHTML = '';

                if (this.invoices.length === 0) {
                    historyContainer.innerHTML = `
                        <div style="text-align: center; color: var(--text-secondary); padding: var(--spacing-lg);">
                            <i class='bx bx-info-circle' style="font-size: 3rem; margin-bottom: var(--spacing-md);"></i>
                            <p>هیچ فاکتوری ثبت نشده است</p>
                        </div>
                    `;
                    return;
                }

                this.invoices.forEach(invoice => {
                    const invoiceElement = document.createElement('div');
                    invoiceElement.className = 'invoice-item';

                    invoiceElement.innerHTML = `
                        <div class="invoice-header">
                            <strong>فاکتور #${invoice.number}</strong>
                            <div style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 8px;">
                                <i class='bx bx-calendar'></i> ${invoice.date}
                            </div>
                        </div>
                        <div style="margin: var(--spacing-md) 0; text-align: center;">
                            <div><i class='bx bx-user'></i> ${invoice.customer}</div>
                            <div><i class='bx bx-phone'></i> ${invoice.phone}</div>
                        </div>
                        <div class="invoice-items">
                            ${invoice.items.map(item => `
                                <div class="invoice-item-row">
                                    <span>${item.name}</span>
                                    <span>${item.quantity} عدد × ${item.price.toLocaleString()} ریال</span>
                                    <span>${item.subtotal.toLocaleString()} ریال</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="invoice-total">
                            <i class='bx bx-credit-card'></i>
                            مبلغ نهایی: ${invoice.total.toLocaleString()} ریال
                        </div>
                    `;

                    historyContainer.appendChild(invoiceElement);
                });
            }
        }

        // Initialize the sales system
        const salesSystem = new SalesSystem();

        // Make functions globally available for onclick attributes
        function addProduct() {
            salesSystem.addProduct();
        }

        function generateInvoice() {
            salesSystem.generateInvoice();
        }

        function calculateTotal() {
            salesSystem.calculateTotal();
        }
    </script>
</body>
</html>
